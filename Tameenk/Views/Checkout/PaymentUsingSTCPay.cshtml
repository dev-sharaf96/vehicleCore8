@*@model IEnumerable<KeyValuePair<string, string>>*@
@using Tameenk.Core.Domain.Enums;
<script src="https://oppwa.com/v1/paymentWidgets.js?checkoutId=@ViewBag.Id"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

@{
    var id = ViewBag.Id;
    var email = ViewBag.Email;
    var referenceId = ViewBag.ReferenceId;
    var isCheckoutEmailVerified = ViewBag.IsCheckoutEmailVerified;
    var url = Url.Action("PaymentSTCPayResponse", "TameenkPayment");
    url = $"{this.Request.Url.Scheme}://{this.Request.Url.Authority}{url}";
}

@if (!isCheckoutEmailVerified)
{
    @Html.Partial("~/Views/Checkout/_EmailSentToReceivePolicy.cshtml", new Tameenk.Models.Payments.SendActivationEmailModel() { CheckoutEmail = email, ReferenceId = referenceId })
}

<div class="center-div">
    <form action="@url" class="paymentWidgets" data-brands="STC_PAY"></form>

</div>

@section scripts {
    <script type='text/javascript'>
        $(function () {
            $("form#PayForm").submit();
        });
    </script>
    @if (System.Globalization.CultureInfo.CurrentCulture.TwoLetterISOLanguageName.Equals(LanguageTwoLetterIsoCode.En.ToString(),
StringComparison.OrdinalIgnoreCase))
    {
        <script>
            var lang = "en";
        </script>

    }
    else
    {
        <script>
            var lang = "ar";
        </script>
    }

    <script type='text/javascript'>
        var wpwlOptions = {
            style: "card",
            locale: lang,
            onReady: function(){
 var createRegistrationHtml = '<input style="display:none" type="checkbox" name="createRegistration" value="true" checked />'; $('form.wpwl-form-card').find('.wpwl-button').before(createRegistrationHtml);
 $('.wpwl-form-virtualAccount-STC_PAY .wpwl-wrapper-radio-qrcode').hide(); $('.wpwl-form-virtualAccount-STC_PAY .wpwl-wrapper-radio-mobile').hide(); $('.wpwl-form-virtualAccount-STC_PAY .wpwl-group-paymentMode').hide(); $('.wpwl-form-virtualAccount-STC_PAY .wpwl-wrapper-radio-mobile .wpwl-control-radio-mobile').attr('checked',true); $('.wpwl-form-virtualAccount-STC_PAY .wpwl-wrapper-radio-mobile .wpwl-control-radio-mobile').trigger('click'); }}


    </script>
    <script type="text/javascript">
         window.onload = function(){
            document.getElementById('EmailSentToReceivePolicyCheckoutPopup').style.display = 'block'; // show
        };

        function SendActivationEmail(referenceId)
        {
            $("#SendActivationEmailBtn").attr("disabled", "disabled");
            var url = "@Url.Action("SendActivationEmailToReceivePolicy", "Checkout")";
            $.ajax({
            url: url,
            type: "GET",
            data: {referenceId:referenceId},
            success: function (data) {
                if(data.data==0)
                {
                    $("#messageLabel").html("@Html.Raw(LangText.ActivationEmailSent)");
                }
                else{
                    $("#SendActivationEmailBtn").removeAttr("disabled");
                    $("#messageLabel").html("@Html.Raw(LangText.GenericError)");
                }

                $('#messageLabel').css('display','inline-flex');
                }
            });
        }
    </script>
}

<style>
    .wpwl-wrapper-cardNumber, wpwl-group {
        direction: ltr !important;
    }

    .center-div {
        position: absolute;
        margin: auto;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 400px;
        height: 400px;
        border-radius: 3px;
    }
</style>